<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geopm::PluginFactory(3) -- abstract factory for plugins &mdash; GEOPM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="geopm::PowerBalancer(3) -- balances power according to epoch runtime" href="GEOPM_CXX_MAN_PowerBalancer.3.html" />
    <link rel="prev" title="geopm::PlatformTopo(3) -- platform topology information" href="GEOPM_CXX_MAN_PlatformTopo.3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GEOPM
            <img src="https://geopm.github.io/images/geopm-logo-clear.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="service.html">Guide for Service Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Guide for HPC Runtime Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Guide for Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel.html">Guide for GEOPM Developers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="reference.html">Reference Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="reference.html#geopm-manual-pages">GEOPM Manual Pages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="geopm.7.html">geopm(7) -- Global Extensible Open Power Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio.7.html">geopm_pio(7) -- GEOPM PlatformIO interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_cnl.7.html">geopm_pio_cnl(7) -- Signals and controls for Compute Node Linux Board-Level Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_cpuinfo.7.html">geopm_pio_cpuinfo(7) -- Signals and controls for the CPUInfoIOGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_dcgm.7.html">geopm_pio_dcgm(7) -- IOGroup providing signals and controls for NVIDIA GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_levelzero.7.html">geopm_pio_levelzero(7) -- IOGroup providing signals and controls for Intel GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_msr.7.html">geopm_pio_msr(7) -- Signals and controls for Model Specific Registers (MSRs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_nvml.7.html">geopm_pio_nvml(7) -- IOGroup providing signals and controls for NVIDIA GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_profile.7.html">geopm_pio_profile(7) -- Signals and controls for the ProfileIOGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_service.7.html">geopm_pio_service(7) -- Signals and controls for the ServiceIOGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_sst.7.html">geopm_pio_sst(7) -- Signals and controls for Intel Speed Select Technology</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio_time.7.html">geopm_pio_time(7) -- Signals and controls for Time IO Group</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmaccess.1.html">geopmaccess(1) -- Access management for the GEOPM Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmadmin.1.html">geopmadmin(1) -- tool for GEOPM system administrators</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmagent.1.html">geopmagent(1) -- query agent information and create static policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmbench.1.html">geopmbench(1) -- synthetic benchmark application</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmctl.1.html">geopmctl(1) -- GEOPM runtime control application</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmendpoint.1.html">geopmendpoint(1) -- command line tool for dynamic policy control</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmlaunch.1.html">geopmlaunch(1) -- application launch wrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmread.1.html">geopmread(1) -- query platform information</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmsession.1.html">geopmsession(1) -- Command line interface for the GEOPM service batch read features</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmwrite.1.html">geopmwrite(1) -- modify platform state</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmdpy.7.html">geopmdpy(7) -- global extensible open power manager python daemon package</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopmpy.7.html">geopmpy(7) -- global extensible open power manager python package</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_agent.3.html">geopm_agent(3) -- query information about available agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_ctl.3.html">geopm_ctl(3) -- GEOPM runtime control thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_daemon.3.html">geopm_daemon(3) -- helpers for GEOPM daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_endpoint.3.html">geopm_endpoint(3) -- dynamic policy control for resource management</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_error.3.html">geopm_error(3) -- error code descriptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_fortran.3.html">geopm_fortran(3) -- GEOPM fortran interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_hash.3.html">geopm_hash(3) -- helper methods for encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_imbalancer.3.html">geopm_imbalancer(3) -- set artificial runtime imbalance</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_pio.3.html">geopm_pio(3) -- interfaces to query and modify platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_policystore.3.html">geopm_policystore(3) -- GEOPM resource policy store interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_prof.3.html">geopm_prof(3) -- application profiling interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_sched.3.html">geopm_sched(3) -- interface with Linux scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_time.3.html">geopm_time(3) -- helper methods for time</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_topo.3.html">geopm_topo(3) -- query platform component topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_version.3.html">geopm_version(3) -- GEOPM library version</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Agent.3.html">geopm::Agent(3) -- GEOPM agent plugin interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Agg.3.html">geopm::Agg(3) -- data aggregation functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_CNLIOGroup.3.html">geopm::CNLIOGroup(3) -- IOGroup for interaction with Compute Node Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_CircularBuffer.3.html">geopm::CircularBuffer(3) -- generic circular buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Comm.3.html">geopm::Comm(3) -- communication abstractions</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_CpuinfoIOGroup.3.html">geopm::CpuinfoIOGroup(3) -- IOGroup for CPU frequency limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Daemon.3.html">geopm::Daemon(3) -- GEOPM daemon helper methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Endpoint.3.html">geopm::Endpoint(3) -- GEOPM endpoint interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Exception.3.html">geopm::Exception(3) -- custom GEOPM exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_Helper.3.html">geopm::Helper -- common helper methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_IOGroup.3.html">geopm::IOGroup(3) -- provides system values and settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_MPIComm.3.html">geopm::MPIComm(3) -- implementation of Comm using MPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_MSRIO.3.html">geopm::MSRIO(3) -- methods for reading and writing MSRs</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_MSRIOGroup.3.html">geopm::MSRIOGroup -- IOGroup providing MSR-based signals and controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_MonitorAgent.3.html">geopm::MonitorAgent -- agent that enforces no policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PlatformIO.3.html">geopm::PlatformIO(3) -- GEOPM platform interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PlatformTopo.3.html">geopm::PlatformTopo(3) -- platform topology information</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">geopm::PluginFactory(3) -- abstract factory for plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#namespaces">Namespaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#terms">Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#factory-class-methods">Factory Class Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-a-plugin-shared-object">Building A Plugin Shared Object</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plugin-search-path-and-load-order">Plugin Search Path And Load Order</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plugin-load-constructor-function">Plugin Load Constructor Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plugin-class-static-methods">Plugin Class Static Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-register-iogroup-plugin">EXAMPLE: REGISTER IOGROUP PLUGIN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-register-agent-plugin">EXAMPLE: REGISTER AGENT PLUGIN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PowerBalancer.3.html">geopm::PowerBalancer(3) -- balances power according to epoch runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PowerBalancerAgent.3.html">geopm::PowerBalancerAgent(3) -- agent optimizing performance under a power cap</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PowerGovernor.3.html">geopm::PowerGovernor(3) -- enforces a power limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_PowerGovernorAgent.3.html">geopm::PowerGovernorAgent(3) -- agent that enforces a power cap</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_ProfileIOGroup.3.html">geopm::ProfileIOGroup(3) -- IOGroup providing application signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_SampleAggregator.3.html">geopm::SampleAggregator(3) -- per-region aggregated signal data</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_SharedMemory.3.html">geopm::SharedMemory(3) -- abstractions for shared memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="GEOPM_CXX_MAN_TimeIOGroup.3.html">geopm::TimeIOGroup(3) -- IOGroup providing time signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_report.7.html">geopm_report(7) -- GEOPM summary report file</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_agent_frequency_map.7.html">geopm_agent_frequency_map(7) -- agent for running regions at user selected frequencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_agent_monitor.7.html">geopm_agent_monitor(7) -- agent implementation for aggregating statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_agent_power_balancer.7.html">geopm_agent_power_balancer(7) -- agent optimizes performance under a power cap</a></li>
<li class="toctree-l3"><a class="reference internal" href="geopm_agent_power_governor.7.html">geopm_agent_power_governor(7) -- agent enforces a power cap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#doxygen-pages">Doxygen Pages</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="reference.html">Reference Manual</a> &raquo;</li>
      <li>geopm::PluginFactory(3) -- abstract factory for plugins</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/GEOPM_CXX_MAN_PluginFactory.3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="geopm-pluginfactory-3-abstract-factory-for-plugins">
<h1>geopm::PluginFactory(3) -- abstract factory for plugins<a class="headerlink" href="#geopm-pluginfactory-3-abstract-factory-for-plugins" title="Permalink to this headline"></a></h1>
<section id="namespaces">
<h2>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">PluginFactory</span></code> class template is a member of the <code class="docutils literal notranslate"><span class="pre">namespace</span> <span class="pre">geopm</span></code>, but
the full name, <code class="docutils literal notranslate"><span class="pre">geopm::PluginFactory&lt;class</span> <span class="pre">T&gt;</span></code>, has been abbreviated in this
manual.  Similarly, the <code class="docutils literal notranslate"><span class="pre">std::</span></code> namespace specifier has been omitted from the
interface definitions for the following standard types: <code class="docutils literal notranslate"><span class="pre">std::vector</span></code>,
<code class="docutils literal notranslate"><span class="pre">std::string</span></code>, <code class="docutils literal notranslate"><span class="pre">std::set</span></code>, and <code class="docutils literal notranslate"><span class="pre">std::function</span></code>, to enable better rendering of
this manual.</p>
</section>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline"></a></h2>
<p>#include <a class="reference external" href="https://github.com/geopm/geopm/blob/dev/service/src/geopm/PluginFactory.hpp">&lt;geopm/PluginFactory.hpp&gt;</a></p>
<p>Link with <code class="docutils literal notranslate"><span class="pre">-lgeopm</span></code> <strong>(MPI)</strong> or <code class="docutils literal notranslate"><span class="pre">-lgeopmpolicy</span></code> <strong>(non-MPI)</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">register_plugin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">plugin_name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                       </span><span class="n">function</span><span class="o">&lt;</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">make_plugin</span><span class="p">,</span><span class="w"></span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dictionary</span><span class="p">);</span><span class="w"></span>

<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">make_plugin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">plugin_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">plugin_names</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">dictionary</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">plugin_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline"></a></h2>
<p>GEOPM can be extended though <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code>, and <code class="docutils literal notranslate"><span class="pre">Comm</span></code> plugins.
This man page describes the steps for adding a plugin.  Refer to
<a class="reference internal" href="GEOPM_CXX_MAN_Agent.3.html"><span class="doc">geopm::Agent(3)</span></a>, and <a class="reference internal" href="GEOPM_CXX_MAN_IOGroup.3.html"><span class="doc">geopm::IOGroup(3)</span></a> for
more details about these interfaces.  Any <strong>C++</strong> class that derives from
one of these plugin base classes and is compiled into a shared object
file can be loaded at application launch time through the GEOPM plugin
interface.  This allows users and system administrators to extend the
features and behavior of the monitor and control process that GEOPM
executes without recompiling the GEOPM runtime.</p>
<p>There are several steps to implementing and integrating a plugin into
GEOPM.  First, the base class interface must be completely implemented
by the new class.  In addition to the <code class="docutils literal notranslate"><span class="pre">virtual</span></code> methods required by the
interface, there are several recommended <code class="docutils literal notranslate"><span class="pre">static</span></code> class methods,
described below, that should also be implemented by the derived class
to aid in registration with the plugin factory.  Finally, the plugin
must be registered with the appropriate factory at plugin load time.
This process is discussed in more detail in the following sections.
The factory singletons for <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code>, and <code class="docutils literal notranslate"><span class="pre">Comm</span></code> plugins are
available through their respective single accessor functions:
<code class="docutils literal notranslate"><span class="pre">geopm::agent_factory()</span></code>, <code class="docutils literal notranslate"><span class="pre">geopm::iogroup_factory()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">geopm::comm_factory()</span></code>.</p>
<p>A good starting point for implementing a new <code class="docutils literal notranslate"><span class="pre">Agent</span></code> or <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code>
plugin is to modify the examples found in the <a class="reference external" href="https://github.com/geopm/geopm/tree/dev/tutorial/agent">Agent tutorial</a> and
the <a class="reference external" href="https://github.com/geopm/geopm/tree/dev/tutorial/iogroup">IOGroup tutorial</a>.
This code is located in the GEOPM source under <code class="docutils literal notranslate"><span class="pre">tutorial/agent</span></code> and
<code class="docutils literal notranslate"><span class="pre">tutorial/iogroup</span></code> respectively.</p>
</section>
<section id="terms">
<h2>Terms<a class="headerlink" href="#terms" title="Permalink to this headline"></a></h2>
<p>Below are some definitions of terms that are used to describe
different parts of the GEOPM runtime.  Understanding these terms will
help to interpret the documentation about how to extend the GEOPM
runtime.  These are arranged from from highest levels of abstraction
down to the lowest levels of abstraction.</p>
<ul class="simple">
<li><p><strong>launcher</strong>:
Wrapper of system application launch (e.g. <code class="docutils literal notranslate"><span class="pre">srun</span></code> or <code class="docutils literal notranslate"><span class="pre">aprun</span></code>) that
executes the GEOPM runtime with the application.</p></li>
<li><p><strong>report</strong>:
Text file containing summary of aggregated stats collected during
application run.</p></li>
<li><p><strong>trace</strong>:
Time series of signals collected over application run in a pipe
separated ASCII table.</p></li>
<li><p><strong>agent</strong>:
Implementation used by GEOPM to interpret sampled data and
enforce the appropriate controls.</p></li>
<li><p><strong>policy</strong>:
Array of floating-point settings for <code class="docutils literal notranslate"><span class="pre">Agent</span></code>-specific control
parameters in SI units.</p></li>
<li><p><strong>sample</strong>:
Array of floating-point values providing <code class="docutils literal notranslate"><span class="pre">Agent</span></code>-specific runtime
statistics in SI units.</p></li>
<li><p><strong>endpoint</strong>:
Interface between resource manager and GEOPM runtime.  This feature
is still under development and is only available when GEOPM is compiled
with the <code class="docutils literal notranslate"><span class="pre">--enable-beta</span></code> flag.</p></li>
<li><p><strong>profile</strong>:
Interface for annotating compute application; provides <code class="docutils literal notranslate"><span class="pre">PlatformIO</span></code>
region signals.</p></li>
<li><p><strong>controller</strong>:
Thread on each compute node that loads plugins and runs GEOPM
algorithm.</p></li>
<li><p><strong>level</strong>:
Attribute of an <code class="docutils literal notranslate"><span class="pre">Agent</span></code> describing the number of edges between it
and the nearest leaf <code class="docutils literal notranslate"><span class="pre">Agent</span></code> in the communication tree (a leaf
<code class="docutils literal notranslate"><span class="pre">Agent</span></code> is <em>level</em> zero).</p></li>
<li><p><strong>signal</strong>:
Named parameter in SI units that can be measured using <code class="docutils literal notranslate"><span class="pre">PlatformIO</span></code>.</p></li>
<li><p><strong>control</strong>:
Named parameter in SI units that can be set using <code class="docutils literal notranslate"><span class="pre">PlatformIO</span></code>.</p></li>
</ul>
</section>
<section id="factory-class-methods">
<h2>Factory Class Methods<a class="headerlink" href="#factory-class-methods" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">register_plugin()</span></code>: Add a plugin to this factory.  The
<em>plugin_name</em> parameter will be used to request plugins of the
registered type.  The <em>make_plugin</em> parameter is a function that
returns a new object of the registered type.  The <em>dictionary</em> is
an optional string-to-string dictionary containing static
information about the registered type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make_plugin()</span></code>: Creates an object of the registered type.  If the type
was not previously registered, an exception will be thrown.  The
<em>plugin_name</em> parameter will be used to look up the constructor function
used to create the object. Returns a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> to the created object.
The caller owns the created object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_names()</span></code>: Returns a list of all valid plugin names that have been
registered with this factory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dictionary()</span></code>: Returns an optional dictionary of static metadata about
a registered type.  If the type was not registered, an exception is thrown.
The <em>plugin_name</em> parameter is used to look up the desired dictionary.</p></li>
</ul>
</section>
<section id="building-a-plugin-shared-object">
<h2>Building A Plugin Shared Object<a class="headerlink" href="#building-a-plugin-shared-object" title="Permalink to this headline"></a></h2>
<p>A GEOPM plugin is a shared object file that is loaded at runtime by
the <em>controller</em> through the <a class="reference external" href="https://man7.org/linux/man-pages/man3/dlopen.3.html">dlopen(3)</a> interface.  Each file
provides a new implementation for one of the three extensible classes:
<code class="docutils literal notranslate"><span class="pre">IOGroup</span></code>, <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, and <code class="docutils literal notranslate"><span class="pre">Comm</span></code>.  Each implementation is identified by
a unique name string referred to as the <em>plugin_name</em>.  An exception
will be thrown if more than one plugin of the same name and same type
are loaded.  The <em>plugin_name</em> is standardized to be all lower case
letters.  The shared object file names must conform to the pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libgeopm</span><span class="o">&lt;</span><span class="n">CLASS</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">NAME</span><span class="o">&gt;.</span><span class="n">so</span><span class="mf">.1.0.0</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">&lt;NAME&gt;</span></code> is the <em>plugin_name</em> and <code class="docutils literal notranslate"><span class="pre">&lt;CLASS&gt;</span></code> is one of the three
strings identifying the plugin type: <code class="docutils literal notranslate"><span class="pre">&quot;iogroup&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;agent&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;comm&quot;</span></code>.
The current GEOPM ABI version is <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code>, and the file name must end
with this string.  Plugins must be marked to have exactly the same ABI
version as the GEOPM library they are intended to be loaded by.  Do
not link the plugin shared object against any of the GEOPM libraries;
this will cause a circular link dependency.  Compile the shared object
with flags appropriate for a dynamically loaded library, e.g. for
<code class="docutils literal notranslate"><span class="pre">g++</span></code> and <code class="docutils literal notranslate"><span class="pre">icpc</span></code> you must provide the <code class="docutils literal notranslate"><span class="pre">-fPIC</span></code> and <code class="docutils literal notranslate"><span class="pre">-shared</span></code> options.</p>
</section>
<section id="plugin-search-path-and-load-order">
<h2>Plugin Search Path And Load Order<a class="headerlink" href="#plugin-search-path-and-load-order" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">GEOPM_PLUGIN_PATH</span></code> is a colon-separated list of directories
that contain plugin shared object files to be loaded by the GEOPM
runtime.  See <a class="reference internal" href="geopm.7.html"><span class="doc">geopm(7)</span></a> for details about <code class="docutils literal notranslate"><span class="pre">GEOPM_PLUGIN_PATH</span></code>.
Note that an Exception will be thrown by the <code class="docutils literal notranslate"><span class="pre">register_plugin()</span></code>
method if an attempt is made to register a plugin with the same name
as a previously registered plugin.</p>
<p>In the case of <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code> plugins, the most recently loaded plugin to
register a signal or control name provides the implementation at
runtime, even if an earlier <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code> plugin had provided a signal or
control with the same name.  The plugins in the <code class="docutils literal notranslate"><span class="pre">GEOPM_PLUGIN_PATH</span></code>
are loaded in reverse (right to left) order so that plugins earlier in
the search path from left to right are preferred when looking up
signal and control implementations.  The default search path
(<code class="docutils literal notranslate"><span class="pre">&lt;PREFIX&gt;/lib/geopm</span></code>) will have the lowest priority.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">GEOPM_PLUGIN_PATH</span></code> is set using the exports below,
the plugins in <code class="docutils literal notranslate"><span class="pre">$HOME/plugin/iogroup</span></code> will be used with the highest
priority to provide signal and control names, followed by the plugins
in <code class="docutils literal notranslate"><span class="pre">$GEOPM_HOME/tutorial/iogroup</span></code>.  Plugins in the default path will
only be used if no higher priority implementation is found.  A more
detailed example of plugin load order can be found in
<code class="docutils literal notranslate"><span class="pre">tutorial/plugin_load</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">GEOPM_PLUGIN_PATH</span><span class="o">=</span><span class="nv">$GEOPM_HOME</span>/tutorial/iogroup
<span class="nb">export</span> <span class="nv">GEOPM_PLUGIN_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/plugin/iogroup:<span class="nv">$GEOPM_PLUGIN_PATH</span>
</pre></div>
</div>
</section>
<section id="plugin-load-constructor-function">
<h2>Plugin Load Constructor Function<a class="headerlink" href="#plugin-load-constructor-function" title="Permalink to this headline"></a></h2>
<p>The shared object file must provide a function that is decorated with
the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> compiler directive.  The <code class="docutils literal notranslate"><span class="pre">__attribute__((constructor))</span></code>
enables the registration of plugins when the shared object is loaded
by a call to <a class="reference external" href="https://man7.org/linux/man-pages/man3/dlopen.3.html">dlopen(3)</a>.
Please see the <code class="docutils literal notranslate"><span class="pre">gcc</span></code> documentation for the
<a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc-4.3.0/gcc/Function-Attributes.html">constructor attribute</a>.</p>
</section>
<section id="plugin-class-static-methods">
<h2>Plugin Class Static Methods<a class="headerlink" href="#plugin-class-static-methods" title="Permalink to this headline"></a></h2>
<p>It is recommended that each class deriving from one of the GEOPM
plugin classes implement two static helper methods called
<code class="docutils literal notranslate"><span class="pre">plugin_name()</span></code> and <code class="docutils literal notranslate"><span class="pre">make_plugin()</span></code>.  These functions can be used to
provide the inputs to <code class="docutils literal notranslate"><span class="pre">PluginFactory::register_plugin()</span></code>.  Note that
the first argument to <code class="docutils literal notranslate"><span class="pre">register_plugin()</span></code> is a <code class="docutils literal notranslate"><span class="pre">string</span></code>, i.e. the result
of calling <code class="docutils literal notranslate"><span class="pre">plugin_name()</span></code>, whereas the <code class="docutils literal notranslate"><span class="pre">make_plugin()</span></code> function itself is
passed as the second argument.  The <code class="docutils literal notranslate"><span class="pre">make_plugin()</span></code> function should take
no arguments and returns a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> to an object of the derived
class.  The <code class="docutils literal notranslate"><span class="pre">plugin_name()</span></code> function should take no arguments and return a
<code class="docutils literal notranslate"><span class="pre">string</span></code> specifying the name of the plugin.  The process for registering
<code class="docutils literal notranslate"><span class="pre">IOGroup</span></code> and <code class="docutils literal notranslate"><span class="pre">Comm</span></code> plugins is identical other than the factory singleton
name and is shown in the example below.  In the case of <code class="docutils literal notranslate"><span class="pre">Agent</span></code> plugins,
additional metadata is passed in the form of a dictionary as the third
argument to <code class="docutils literal notranslate"><span class="pre">register_plugin()</span></code>.  This dictionary is used by <code class="docutils literal notranslate"><span class="pre">Agent</span></code>
class helper methods to look up information about the sample and
policy names required by the <code class="docutils literal notranslate"><span class="pre">Agent</span></code>.</p>
</section>
<section id="example-register-iogroup-plugin">
<h2>EXAMPLE: REGISTER IOGROUP PLUGIN<a class="headerlink" href="#example-register-iogroup-plugin" title="Permalink to this headline"></a></h2>
<p>Please see the <a class="reference external" href="https://github.com/geopm/geopm/tree/dev/tutorial/iogroup">IOGroup tutorial</a> for more
information.  This code is located in the GEOPM source under <code class="docutils literal notranslate"><span class="pre">tutorial/iogroup</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// This example shows how to register an IOGroup plugin</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geopm/IOGroup.hpp&gt;</span><span class="c1"> // geopm::IOGroup,</span><span class="cp"></span>
<span class="w">                             </span><span class="c1">// geopm::iogroup_factory</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geopm/Helper.hpp&gt;</span><span class="c1">  // geopm::make_unique</span><span class="cp"></span>

<span class="c1">// Header providing class ExampleIOGroup interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ExampleIOGroup.hpp&quot;</span><span class="cp"></span>

<span class="c1">// Called during dlopen() to register plugin</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span><span class="w"></span>
<span class="n">register_plugin_example_iogroup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">geopm</span><span class="o">::</span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">geopm</span><span class="o">::</span><span class="n">IOGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iof</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">geopm</span><span class="o">::</span><span class="n">iogroup_factory</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">iof</span><span class="p">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">ExampleIOGroup</span><span class="o">::</span><span class="n">plugin_name</span><span class="p">(),</span><span class="w"></span>
<span class="w">                        </span><span class="n">ExampleIOGroup</span><span class="o">::</span><span class="n">make_plugin</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Static method used by the factory to create objects</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">IOGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExampleIOGroup</span><span class="o">::</span><span class="n">make_plugin</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">geopm</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ExampleIOGroup</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Static method providing unique plugin name</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">ExampleIOGroup</span><span class="o">::</span><span class="n">plugin_name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-register-agent-plugin">
<h2>EXAMPLE: REGISTER AGENT PLUGIN<a class="headerlink" href="#example-register-agent-plugin" title="Permalink to this headline"></a></h2>
<p>Please see the <a class="reference external" href="https://github.com/geopm/geopm/tree/dev/tutorial/agent">Agent tutorial</a> for more
information.  This code is located in the GEOPM source under <code class="docutils literal notranslate"><span class="pre">tutorial/agent</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// This example shows how to register an Agent plugin</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geopm/Agent.hpp&gt;</span><span class="c1">  // geopm::Agent,</span><span class="cp"></span>
<span class="w">                            </span><span class="c1">// geopm::agent_factory</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geopm/Helper.hpp&gt;</span><span class="c1"> // geopm::make_unique</span><span class="cp"></span>

<span class="c1">// Header providing class ExampleAgent interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ExampleAgent.hpp&quot;</span><span class="cp"></span>

<span class="c1">// Called during dlopen() to register plugin</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span><span class="w"></span>
<span class="n">register_plugin_example_agent</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">geopm</span><span class="o">::</span><span class="n">PluginFactory</span><span class="o">&lt;</span><span class="n">geopm</span><span class="o">::</span><span class="n">Agent</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">geopm</span><span class="o">::</span><span class="n">agent_factory</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">af</span><span class="p">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">plugin_name</span><span class="p">(),</span><span class="w"></span>
<span class="w">                       </span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">make_plugin</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">geopm</span><span class="o">::</span><span class="n">Agent</span><span class="o">::</span><span class="n">make_dictionary</span><span class="p">(</span><span class="w"></span>
<span class="w">                           </span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">policy_names</span><span class="p">(),</span><span class="w"></span>
<span class="w">                           </span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">sample_names</span><span class="p">()));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Static method used by the factory to create objects</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">geopm</span><span class="o">::</span><span class="n">Agent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">make_plugin</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">geopm</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ExampleAgent</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Static method providing unique plugin name</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">ExampleAgent</span><span class="o">::</span><span class="n">plugin_name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline"></a></h2>
<p><a class="reference internal" href="geopm.7.html"><span class="doc">geopm(7)</span></a>,
<a class="reference internal" href="GEOPM_CXX_MAN_Agent.3.html"><span class="doc">geopm::Agent(3)</span></a>,
<a class="reference internal" href="GEOPM_CXX_MAN_IOGroup.3.html"><span class="doc">geopm::IOGroup(3)</span></a>,
<a class="reference external" href="https://man7.org/linux/man-pages/man3/dlopen.3.html">dlopen(3)</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="GEOPM_CXX_MAN_PlatformTopo.3.html" class="btn btn-neutral float-left" title="geopm::PlatformTopo(3) -- platform topology information" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="GEOPM_CXX_MAN_PowerBalancer.3.html" class="btn btn-neutral float-right" title="geopm::PowerBalancer(3) -- balances power according to epoch runtime" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 - 2022, Intel Corporation. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>