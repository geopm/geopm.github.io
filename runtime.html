<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide for GEOPM Runtime &mdash; GEOPM  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributor Guide" href="contrib.html" />
    <link rel="prev" title="Service Clients" href="client.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GEOPM
              <img src="https://geopm.github.io/images/geopm-logo-clear.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.1.1.dev47+g6e066589
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guides.html">User Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="service.html">User Guide for GEOPM Service</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">User Guide for GEOPM Runtime</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-model">User Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#measuring-performance">1. Measuring Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-configuration">2. Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-data-analysis">3. Advanced Data Analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-requirements">Build Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-geopm-runtime">Building the GEOPM Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-requirements">Run Requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bios-configuration">BIOS Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-power-management">Linux Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#launching-the-geopm-runtime">Launching the GEOPM Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu-affinity-requirements">CPU Affinity Requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#resource-manager-integration">Resource Manager Integration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user_guides.html">User Guides</a></li>
      <li class="breadcrumb-item active">User Guide for GEOPM Runtime</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/runtime.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide-for-geopm-runtime">
<h1>User Guide for GEOPM Runtime<a class="headerlink" href="#user-guide-for-geopm-runtime" title="Link to this heading"></a></h1>
<p>The GEOPM Runtime is software designed to enhance energy efficiency of
applications through active hardware configuration. See
<a class="reference internal" href="overview.html#straight-ruler-measure-performance"><span class="std std-ref">Getting Started Guide</span></a>
for information on how to begin using the GEOPM Runtime.</p>
<section id="user-model">
<h2>User Model<a class="headerlink" href="#user-model" title="Link to this heading"></a></h2>
<p>The architecture is designed to provide a secure infrastructure to
support a wide range of tuning algorithms while solving three related
challenges:</p>
<section id="measuring-performance">
<h3>1. Measuring Performance<a class="headerlink" href="#measuring-performance" title="Link to this heading"></a></h3>
<p>For hardware tuning algorithms, the first challenge involves generating a
durable estimate of application performance. In energy efficiency terms,
performance measurements are performance-to-power ratios, for example,
“perf per watt”. Therefore, any dynamic hardware power control tuning
that aims for energy efficiency must formulate an estimate of application
performance. Without specific application feedback on the critical path,
these performance estimate might prove inaccurate, causing hardware
tuning algorithms to potentially disrupt application performance and lead
to elongated run times, resulting in higher energy costs per unit of work
than without the adaptive algorithm.</p>
</section>
<section id="hardware-configuration">
<h3>2. Hardware Configuration<a class="headerlink" href="#hardware-configuration" title="Link to this heading"></a></h3>
<p>The second challenge arises from allowing hardware control algorithms to
be influenced by unprivileged user input (like application feedback), which
presents a security risk. Not having adequate checks can result in escalated
privileges, service denial, and impacts on other system users’ quality of
service. GEOPM Service is created specifically to mitigate these issues.</p>
</section>
<section id="advanced-data-analysis">
<h3>3. Advanced Data Analysis<a class="headerlink" href="#advanced-data-analysis" title="Link to this heading"></a></h3>
<p>The third challenge is to provide a software development platform suitable for
control algorithms that can be securely deployed and use high-level languages
for data analysis. To effectively enhance energy efficiency for certain
applications, substantial software dependencies may be required. Control
algorithms might lean on optimization software like machine learning
packages or other numerical packages. The application being optimized could
include millions of lines of code, and there may be significant coupling
between the application and the control algorithm. Limiting the privileges
of the process running the control algorithm significantly reduces software
security audit requirements.</p>
</section>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The GEOPM Runtime creates a bridge between GEOPM’s <a class="reference internal" href="geopm_prof.3.html"><span class="doc">application
instrumentation interfaces</span></a> and <a class="reference internal" href="geopm_pio.7.html"><span class="doc">platform
monitoring/control interfaces</span></a>.</p>
<p>By default, the GEOPM Runtime presents relationships between application
instrumentation and platform-monitoring interfaces in a <em>report</em>. For more
complex interactions, such as dynamic control of platform settings, different
GEOPM <em>agents</em> can be utilized.  For more information on user-facing GEOPM
Runtime launch options, please refer to <a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a>
documentation.</p>
<figure class="align-center">
<img alt="An illustration of geopmlaunch running on 2 servers, generating a trace file per host, and one report across all hosts." src="https://geopm.github.io/images/geopm-runtime-usage.svg" />
</figure>
<p>GEOPM <em>agents</em> can exploit this hierarchical control system to optimize
various objective functions. Examples include maximizing application
performance within a power limit (such as GEOPM <a class="reference internal" href="geopm_agent_power_balancer.7.html"><span class="doc">power_balancer
agent</span></a>) or decreasing energy consumption while
minimally affecting application performance. The control hierarchy root
can communicate with the system resource manager to extend the hierarchy
beyond the individual MPI application, thus facilitating multiple MPI jobs
and multiple-user system resource management.</p>
<p>The GEOPM Runtime package includes the libgeopm shared object library. GEOPM
comes with numerous command-line tools, each with dedicated manual pages. The
<a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a> command-line tool launches an MPI
application, enabling the GEOPM runtime to create a GEOPM Controller thread on
each compute node. The Controller loads plugins and runs the Agent algorithm
to manage the compute application. The <a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a>
command is featured in the geopmpy python package that is part of the GEOPM
installation. For more documentation and links, please visit the <a class="reference internal" href="geopm.7.html"><span class="doc">GEOPM
overview man page</span></a>.</p>
<p>GEOPM Runtime offers several built-in algorithms, each incorporated within an
“Agent” implementing the <a class="reference internal" href="geopm%3A%3AAgent.3.html"><span class="doc">geopm::Agent(3)</span></a> class
interface. Developers can expand these algorithm features by creating an Agent
plugin. An implementation of this class can be dynamically loaded at runtime
by the GEOPM Controller. The Agent class determines what data is collected,
how control decisions are made, and how messages are exchanged between
Agents in the compute nodes’ tree hierarchy. The GEOPM Service package,
which resides in the service directory of the GEOPM repository, provides
the PlatformIO interface which abstracts reading signals and writing controls
from the Agent within a compute node. This allows Agent implementations to
be ported to various hardware platforms without modification.</p>
<p>The libgeopm library can be called indirectly or directly within
MPI applications, enabling application feedback to aid control
decisions. Indirect calls are facilitated through GEOPM’s integration with
MPI and OpenMP via their profiling decorators. Direct calls are made through
<a class="reference internal" href="geopm_prof.3.html"><span class="doc">geopm_prof(3)</span></a> or <a class="reference internal" href="geopm_fortran.3.html"><span class="doc">geopm_fortran(3)</span></a>
interfaces. The application can be better integrated with the GEOPM runtime
and controlled more accurately by marking up the compute application with
profiling information obtained through these interfaces.</p>
</section>
<section id="build-requirements">
<h2>Build Requirements<a class="headerlink" href="#build-requirements" title="Link to this heading"></a></h2>
<p>When building the GEOPM Runtime from source, additional requirements must
be met. Those uninterested in building the GEOPM Runtime can ignore these
requirements, or by providing the disable flag to the configure command
line, users may skip particular GEOPM Runtime features enabled by these
requirements.</p>
<p>The GEOPM Runtime provides optional support for MPI standards, Message Passing
Interface, version 2.2 or later.  Building the Runtime with MPI support will
add MPI related region information to the reports as well as enable Agents that
leverage the hierarchical communications tree (just the <code class="docutils literal notranslate"><span class="pre">power_balancer</span></code> at
the time of this writing).  If building for an HPC system, target the desired
site-specific MPI implementation.  Otherwise the Intel MPI implementation,
OpenHPC or Spack packaging systems, or OpenMPI binaries distributed with most
major Linux distributions satisfy this requirement. For RHEL and SLES Linux,
the requirement can be met by installing the <code class="docutils literal notranslate"><span class="pre">openmpi-devel</span></code> package version
1.7 or later, and <code class="docutils literal notranslate"><span class="pre">libopenmpi-dev</span></code> on Ubuntu.</p>
<ul>
<li><p>Install all requirements on <strong>RHEL</strong> or <strong>CentOS</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum<span class="w"> </span>install<span class="w"> </span>openmpi-devel<span class="w"> </span>elfutils<span class="w"> </span>libelf-devel
</pre></div>
</div>
</li>
<li><p>Install all requirements on <strong>SUSE</strong>-based distributions</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>zypper<span class="w"> </span>install<span class="w"> </span>openmpi-devel<span class="w"> </span>elfutils<span class="w"> </span>libelf-devel
</pre></div>
</div>
</li>
<li><p>Install all requirements on <strong>Ubuntu</strong> (as of 18.04.3 LTS)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apt<span class="w"> </span>install<span class="w"> </span>libtool<span class="w"> </span>automake<span class="w"> </span>libopenmpi-dev<span class="w"> </span>build-essential<span class="w"> </span>gfortran<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libelf-dev<span class="w"> </span>python<span class="w"> </span>libsqlite3-dev
</pre></div>
</div>
</li>
</ul>
<p>Requirements that can be avoided by removing features with configure option:</p>
<ul class="simple">
<li><p>Remove MPI compiler requirement
<code class="docutils literal notranslate"><span class="pre">--disable-mpi</span></code></p></li>
<li><p>Remove Fortran compiler requirement
<code class="docutils literal notranslate"><span class="pre">--disable-fortran</span></code></p></li>
<li><p>Remove elfutils library requirement
<code class="docutils literal notranslate"><span class="pre">--disable-ompt</span></code></p></li>
</ul>
<p>For details on how to use non-standard install locations for build
requirements see:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./configure<span class="w"> </span>--help
</pre></div>
</div>
</div></blockquote>
<p>This provides options, for example <code class="docutils literal notranslate"><span class="pre">--with-&lt;feature&gt;</span></code>, to be used for
this purpose, such as <code class="docutils literal notranslate"><span class="pre">--with-mpi-bin</span></code>.</p>
</section>
<section id="building-the-geopm-runtime">
<h2>Building the GEOPM Runtime<a class="headerlink" href="#building-the-geopm-runtime" title="Link to this heading"></a></h2>
<p>The best recommendation for constructing the GEOPM Runtime is to
follow the “developer build process” referenced in the <a class="reference internal" href="devel.html"><span class="doc">developer
guide</span></a>. This will enable GEOPM Service use and also provide the
latest developments in the GEOPM repository.</p>
</section>
<section id="run-requirements">
<h2>Run Requirements<a class="headerlink" href="#run-requirements" title="Link to this heading"></a></h2>
<p>Beyond the GEOPM Service, the GEOPM Runtime requires several additional
features at the time of use. Users uninterested in running the GEOPM Runtime
can ignore these requirements.</p>
<nav class="contents local" id="categories-of-run-requirements">
<p class="topic-title">Categories of run requirements:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#bios-configuration" id="id1">BIOS Configuration</a></p></li>
<li><p><a class="reference internal" href="#linux-power-management" id="id2">Linux Power Management</a></p>
<ul>
<li><p><a class="reference internal" href="#using-slurm-to-control-the-linux-cpu-governor" id="id3">Using Slurm to control the Linux CPU governor</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#launching-the-geopm-runtime" id="id4">Launching the GEOPM Runtime</a></p>
<ul>
<li><p><a class="reference internal" href="#geopm-application-launch-wrapper" id="id5">GEOPM Application Launch Wrapper</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cpu-affinity-requirements" id="id6">CPU Affinity Requirements</a></p></li>
</ul>
</nav>
<section id="bios-configuration">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">BIOS Configuration</a><a class="headerlink" href="#bios-configuration" title="Link to this heading"></a></h3>
<p>If power governing or power balancing is the intended usage for GEOPM
deployment, an additional requirement involves configuring the BIOS to
support RAPL control. To make this check for BIOS support, execute the
following on a compute node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./integration/tutorial/admin/00_test_prereqs.sh
</pre></div>
</div>
<p>If the script output includes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WARNING: The lock bit for the PKG_POWER_LIMIT MSR is set.  The power_balancer
         and power_governor agents will not function properly until this is cleared.
</pre></div>
</div>
<p>Please enable RAPL in your BIOS, and if such an option doesn’t exist please
contact your BIOS vendor to obtain a BIOS that supports RAPL.</p>
<p>For additional information, please contact the GEOPM team.</p>
</section>
<section id="linux-power-management">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Linux Power Management</a><a class="headerlink" href="#linux-power-management" title="Link to this heading"></a></h3>
<p>It’s important to note that other Linux mechanisms for CPU power management may
interfere with performance optimization objectives of GEOPM Agents. To achieve
optimal performance when deploying a GEOPM Agent that controls CPU frequency or
power limits it’s recommended that the generic scaling governor <code class="docutils literal notranslate"><span class="pre">userspace</span></code>
is selected while the GEOPM Agent is active.  If <code class="docutils literal notranslate"><span class="pre">userspace</span></code> is not available
on your system, it may be preferred to select <code class="docutils literal notranslate"><span class="pre">performance</span></code> mode while the
GEOPM Agent is active.</p>
<p>For more information, see the Linux Kernel documentation on
<a class="reference external" href="https://docs.kernel.org/admin-guide/pm/cpufreq.html#generic-scaling-governors">generic scaling governors</a>.</p>
<section id="using-slurm-to-control-the-linux-cpu-governor">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Using Slurm to control the Linux CPU governor</a><a class="headerlink" href="#using-slurm-to-control-the-linux-cpu-governor" title="Link to this heading"></a></h4>
<p>When the <code class="docutils literal notranslate"><span class="pre">userspace</span></code> or <code class="docutils literal notranslate"><span class="pre">performance</span></code> mode is selected, the driver will not
interfere with GEOPM. On SLURM-based systems, the <a class="reference internal" href="#geopm-application-launch-wrapper"><span class="std std-ref">GEOPM launch wrapper</span></a> will attempt to set the scaling
governor to <code class="docutils literal notranslate"><span class="pre">performance</span></code> automatically, eliminating the need to manually set
the governor. On older versions of SLURM, the desired governors must be listed
explicitly in <code class="docutils literal notranslate"><span class="pre">/etc/slurm.conf</span></code>. Specifically, SLURM 15.x requires the
following option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CpuFreqGovernors</span><span class="o">=</span>OnDemand,Performance
</pre></div>
</div>
<p>For more on SLURM configuration, please see the <a class="reference external" href="https://slurm.schedmd.com/slurm.conf.html">slurm.conf manual</a>. On non-SLURM systems, the
scaling governor should still be manually set through some other mechanism
to ensure proper GEOPM behavior. The following command will set the governor
to <code class="docutils literal notranslate"><span class="pre">userspace</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>userspace<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</pre></div>
</div>
</section>
</section>
<section id="launching-the-geopm-runtime">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Launching the GEOPM Runtime</a><a class="headerlink" href="#launching-the-geopm-runtime" title="Link to this heading"></a></h3>
<section id="geopm-application-launch-wrapper">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">GEOPM Application Launch Wrapper</a><a class="headerlink" href="#geopm-application-launch-wrapper" title="Link to this heading"></a></h4>
<p>The GEOPM Runtime package installs the <code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> command. This command is
a wrapper for MPI launch commands such as <code class="docutils literal notranslate"><span class="pre">srun</span></code>, <code class="docutils literal notranslate"><span class="pre">aprun</span></code>, and
<code class="docutils literal notranslate"><span class="pre">mpiexec.hydra</span></code>, where the wrapper script enables the GEOPM runtime. The
<code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> command supports the same command-line interface as the
underlying launch command, while extending the interface with GEOPM-specific
options. The <code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> application launches the primary compute
application and the GEOPM control thread on each compute node.  This wrapper is
documented in the <a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a> man page.</p>
<p>If your system’s launch mechanism is not supported then options to the GEOPM
runtime must be passed through environment variables and some features of the
<code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> command (such as process CPU affinity management) will not be
available.  Please consult the <a class="reference internal" href="geopm.7.html"><span class="doc">geopm(7)</span></a> man page for
documentation of the environment variables used by the GEOPM runtime that would
otherwise be controlled by the wrapper script and see <a class="reference internal" href="overview.html#profiling-applications-without-geopmlaunch"><span class="std std-ref">Profiling Applications without geopmlaunch</span></a>
for details.</p>
</section>
</section>
<section id="cpu-affinity-requirements">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">CPU Affinity Requirements</a><a class="headerlink" href="#cpu-affinity-requirements" title="Link to this heading"></a></h3>
<p>When using the <code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> wrapper, the user may optionally provide the
<code class="docutils literal notranslate"><span class="pre">--geopm-affinity-enable</span></code> command-line option (see
<a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a>). This will enable hardware metrics to be
more accurately measured on a per-application-region basis by restricting
process migration.</p>
<p>While the GEOPM control thread connects to the application it will
automatically affinitize itself to the highest indexed core not used by the
application if the application is not affinitized to a CPU on every core. If
the application is using all cores of the system, the GEOPM control thread
will be pinned to the highest logical CPU.</p>
</section>
</section>
<section id="resource-manager-integration">
<h2>Resource Manager Integration<a class="headerlink" href="#resource-manager-integration" title="Link to this heading"></a></h2>
<p>The GEOPM Runtime package can seamlessly integrate with a compute cluster
resource manager by altering the daemon of the resource manager running on
the cluster compute nodes. An integration example with the SLURM resource
manager through a SPANK plugin is available in the <a class="reference external" href="https://github.com/geopm/geopm-slurm">geopm-slurm git
repository</a>. This example aligns
with the process described below.</p>
<p>To integrate, the daemon requires two <code class="docutils literal notranslate"><span class="pre">libgeopmd.so</span></code> function calls before
allocating resources to the user (prologue) and one function call after
the resources are released (epilogue). In the prologue, the daemon initiates:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">geopm_pio_save_control</span><span class="p">()</span>
</pre></div>
</div>
<p>This function records all controllable GEOPM values into memory (refer
to <a class="reference internal" href="geopm_pio.3.html"><span class="doc">geopm_pio(3)</span></a>). The next function called in the
prologue is:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">geopm_agent_enforce_policy</span><span class="p">()</span>
</pre></div>
</div>
<p>As detailed in <a class="reference internal" href="geopm_agent.3.html"><span class="doc">geopm_agent(3)</span></a>, this function enforces
a pre-set policy like a power cap or a CPU frequency limit by making a
one-time hardware setting adjustment. In the epilogue, the manager triggers:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">geopm_pio_restore_control</span><span class="p">()</span>
</pre></div>
</div>
<p>This restores all GEOPM platform controls to their original state captured
during the prologue.</p>
<p>The policy setup in the prologue relies on two configuration files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/etc/geopm/environment-default.json
/etc/geopm/environment-override.json
</pre></div>
</div>
<p>These files contain JSON objects that map GEOPM environment variables to
their respective values. The default configuration holds values for any
unset GEOPM variable in the calling environment. Meanwhile, the override
configuration enforces values, overriding the calling environment’s
specifications. A comprehensive list of GEOPM environment variables is
available in the geopm(7) man page. The two primary environment variables
that <code class="docutils literal notranslate"><span class="pre">geopm_agent_enforce_policy()</span></code> utilizes are <code class="docutils literal notranslate"><span class="pre">GEOPM_AGENT</span></code> and
<code class="docutils literal notranslate"><span class="pre">GEOPM_POLICY</span></code>. It’s important to note that <code class="docutils literal notranslate"><span class="pre">/etc</span></code> should be mounted on a
local node file system, meaning the GEOPM configuration files typically become
part of the compute node’s boot image. The <code class="docutils literal notranslate"><span class="pre">GEOPM_POLICY</span></code> value directs
to another JSON file, possibly located on a shared file system, dictating
the enforced values (like the power cap in Watts or CPU frequency in Hz).</p>
<p>For GEOPM’s integration as the universal power management solution for
a cluster, it’s usual for a single agent algorithm with one policy to be
applied across all compute nodes within a partition. The choice of agent
rests upon the site’s needs. For instance, if the aim is to keep the average
CPU power draw for each node below a specific cap, the <a class="reference internal" href="geopm_agent_power_balancer.7.html"><span class="doc">power_balancer
agent</span></a> is ideal. However, if the goal is to
limit application CPU frequencies with exceptions for specific high-priority
processes, the <a class="reference internal" href="geopm_agent_frequency_map.7.html"><span class="doc">frequency_map agent</span></a>
is the best fit. Sites can also deploy a custom agent plugin. In every
scenario, invoking <code class="docutils literal notranslate"><span class="pre">geopm_agent_enforce_policy()</span></code> before releasing
compute resources ensures the enforcement of static limits impacting all
user applications. For dynamic runtime features, users must initiate their
MPI application using the <a class="reference internal" href="geopmlaunch.1.html"><span class="doc">geopmlaunch(1)</span></a> tool.</p>
<p>To illustrate, if a system administrator wants to use the <code class="docutils literal notranslate"><span class="pre">power_balancer</span></code>
agent, the process would involve setting a static power cap for
apps not utilizing <code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code>, while optimizing power caps for
performance when <code class="docutils literal notranslate"><span class="pre">geopmlaunch</span></code> is in use. The administrator would
install the following JSON object in the compute node’s boot image at
<code class="docutils literal notranslate"><span class="pre">/etc/geopm/environment-override.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;GEOPM_AGENT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;power_balancer&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;GEOPM_POLICY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/shared_fs/config/geopm_power_balancer.json&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The controlling value, <code class="docutils literal notranslate"><span class="pre">CPU_POWER_LIMIT</span></code>, is defined in a separate
“geopm_power_balancer.json” file that could reside on a shared file
system. This file can be generated using the <a class="reference internal" href="geopmagent.1.html"><span class="doc">geopmagent(1)</span></a> tool. By placing the policy file on a shared file system,
you allow modifications to the limit without affecting the compute node
boot image. Changing the policy value affects all new GEOPM processes but
leaves running GEOPM processes untouched.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="client.html" class="btn btn-neutral float-left" title="Service Clients" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contrib.html" class="btn btn-neutral float-right" title="Contributor Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 - 2024 Intel Corporation. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>