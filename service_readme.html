<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEOPM Service &mdash; GEOPM  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="install.html" />
    <link rel="prev" title="User Guide for GEOPM Service" href="service.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GEOPM
              <img src="https://geopm.github.io/images/geopm-logo-clear.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.1.1.dev154+g7bb0b5ec
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guides.html">User Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="service.html">User Guide for GEOPM Service</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">GEOPM Service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signals-and-controls">Signals and Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-management">Access Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opening-a-session">Opening a Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batch-server">Batch Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="requires.html">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="build.html">Source Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">Service Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="admin.html">Service Administrators</a></li>
<li class="toctree-l3"><a class="reference internal" href="client.html">Service Clients</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="runtime.html">User Guide for GEOPM Runtime</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user_guides.html">User Guides</a></li>
          <li class="breadcrumb-item"><a href="service.html">User Guide for GEOPM Service</a></li>
      <li class="breadcrumb-item active">GEOPM Service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/service_readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="geopm-service">
<h1>GEOPM Service<a class="headerlink" href="#geopm-service" title="Link to this heading">ÔÉÅ</a></h1>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading">ÔÉÅ</a></h2>
<section id="penguin-linux-integration">
<h3>üêß Linux Integration<a class="headerlink" href="#penguin-linux-integration" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>The Linux Systemd Service is integrated with a DBus interface, enabling
user-level access to hardware features on heterogeneous systems.</p>
</div></blockquote>
</section>
<section id="microscope-hardware-telemetry">
<h3>üî¨ Hardware Telemetry<a class="headerlink" href="#microscope-hardware-telemetry" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>Use a vendor-agnostic interface to read telemetry from hardware components on
heterogeneous systems.</p>
</div></blockquote>
</section>
<section id="gear-hardware-configuration">
<h3>‚öôÔ∏è Hardware Configuration<a class="headerlink" href="#gear-hardware-configuration" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>User-friendly vendor-agnostic interface for configuring hardware component
device settings on heterogeneous systems.</p>
</div></blockquote>
</section>
<section id="medal-sports-quality-of-service">
<h3>üèÖ Quality of Service<a class="headerlink" href="#medal-sports-quality-of-service" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>The GEOPM Service reverts any changes made to hardware configurations once
the client‚Äôs Linux process session concludes.</p>
</div></blockquote>
</section>
<section id="lock-security">
<h3>üîí Security<a class="headerlink" href="#lock-security" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>Linux system administrators have complete control over managing fine-grained
access permissions for capabilities exposed by the GEOPM Service.</p>
</div></blockquote>
</section>
<section id="rocket-performance">
<h3>üöÄ Performance<a class="headerlink" href="#rocket-performance" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>A DBus interface can be utilized for the creation of a batch server. The
server provides a low-latency interface with a single permissions validation
when the server is created.</p>
</div></blockquote>
</section>
<section id="electric-plug-extensibility">
<h3>üîå Extensibility<a class="headerlink" href="#electric-plug-extensibility" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p>GEOPM Service supports extensibility for heterogeneous environments through
the C++ plugin infrastructure called IOGroups.</p>
</div></blockquote>
</section>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">ÔÉÅ</a></h2>
<p>The GEOPM Service provides an interface at the user level, allowing users to
read telemetry and configure heterogeneous hardware platforms. Linux system
administrators can manage the permissions for user access to telemetry and
configuration at very detailed level.</p>
<p>The GEOPM Service DBus interface is how clients interact with the service.
Access to the DBus interfaces can be gained from the command line or
programmatically with library interfaces for C, C++, and Python.</p>
<p>The service supports multiple simultaneous client sessions for making
measurements, however only clients from within a single Linux process session
are given write permission to configure hardware control values at any one
time. Upon termination of a client‚Äôs process session leader, the GEOPM Service
restores all hardware settings to their original state before the first
client‚Äôs write request.</p>
<p>For more information about the Linux session leader process, please consult the
<a class="reference external" href="https://man7.org/linux/man-pages/man2/setsid.2.html">setsid(2)</a> manual.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://geopm.github.io/pdf/geopm-service.pdf">Overview slides</a></p></li>
</ul>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">ÔÉÅ</a></h2>
<a class="reference external image-reference" href="https://geopm.github.io/pdf/geopm-service-diagram.pdf"><img alt="" src="https://geopm.github.io/images/geopm-service-diagram.svg" /></a>
<p>The architectural diagram shows the relationship between IOGroups and the GEOPM
Service. IOGroups are the C++ classes that abstract hardware interfaces.
IOGroups provide a plugin mechanism to extend GEOPM‚Äôs functionality.</p>
<p>The PlatformIO interface is a container for all IOGroups and is the main
interface for users who interact with the hardware through the GEOPM Service.
The PlatformIO interface can be accessed through language bindings with Python,
C, and C++ as well as command line tools such as <code class="docutils literal notranslate"><span class="pre">geopmread</span></code> and
<code class="docutils literal notranslate"><span class="pre">geopmwrite</span></code>. The GEOPM DBus interface, <code class="docutils literal notranslate"><span class="pre">io.github.geopm</span></code>, provides a
secure gateway to privileged PlatformIO features. The <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line
tool is used by the administrator to enable user level access to any subset of
the privileged PlatformIO features.</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Link to this heading">ÔÉÅ</a></h2>
<p>The GEOPM systemd service introduced in version 2.0 is fully tested and is now
ready for production.</p>
</section>
<section id="signals-and-controls">
<h2>Signals and Controls<a class="headerlink" href="#signals-and-controls" title="Link to this heading">ÔÉÅ</a></h2>
<p>Each signal and control in GEOPM has a unique name and a hardware domain. The
signals and controls available on your system can be discovered with the
<code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool. The description includes all the necessary
information for end users and system administrators to understand what is
enabled when granting access to a signal or control.</p>
</section>
<section id="access-management">
<h2>Access Management<a class="headerlink" href="#access-management" title="Link to this heading">ÔÉÅ</a></h2>
<p>System administrators configure the access to signals and controls through the
GEOPM Service. The administrator maintains an access list that applies to all
users of the system. Special Unix groups can have enhanced access.  The default
lists are stored in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">/</span><span class="mf">0.</span><span class="n">DEFAULT_ACCESS</span><span class="o">/</span><span class="n">allowed_signals</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">/</span><span class="mf">0.</span><span class="n">DEFAULT_ACCESS</span><span class="o">/</span><span class="n">allowed_controls</span>
</pre></div>
</div>
<p>Each Unix group name <code class="docutils literal notranslate"><span class="pre">&lt;GROUP&gt;</span></code> that has extended permissions can
maintain one or both of the files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">/&lt;</span><span class="n">GROUP</span><span class="o">&gt;/</span><span class="n">allowed_signals</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">/&lt;</span><span class="n">GROUP</span><span class="o">&gt;/</span><span class="n">allowed_controls</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before GEOPM 3.0, service configuration files were stored in
<code class="docutils literal notranslate"><span class="pre">/etc/geopm-service</span></code>. Since version 3.0, they are stored in
<code class="docutils literal notranslate"><span class="pre">/etc/geopm</span></code>. Version 3.0 ignores the old file location if the new
location exists. If the service uses a configuration from the old location,
then a deprecation warning is emitted.</p>
</div>
<p>Any missing files are inferred to be empty lists, including the default access
files.  A signal or control will not be available to non-root users through the
GEOPM Service until a system administrator enables access through these allow
lists.  It is recommended that all manipulation of these files should be done
through the GEOPM Service with the <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool.</p>
<p>All control settings can be read by requesting the signal with the same name.
Whenever a control name is added to the access list for writing, the
administrator implicitly grants read access to the control setting as well.</p>
</section>
<section id="opening-a-session">
<h2>Opening a Session<a class="headerlink" href="#opening-a-session" title="Link to this heading">ÔÉÅ</a></h2>
<p>Each time a client process opens a session with the GEOPM Service, a PlatformIO
object is created with libgeopmd. This session starts in read-only mode. Calls
to the DBus APIs that modify control values convert the session into write mode.
The session retains write access until it ends. Calls into the DBus APIs that
modify control values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">io</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">geopm</span><span class="o">.</span><span class="n">PlatformWriteControl</span>
<span class="n">io</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">geopm</span><span class="o">.</span><span class="n">PlatformPushControl</span>
</pre></div>
</div>
<p>convert the session into write mode.  Only one write mode session is
allowed at any time.  The request will fail if a client attempts to
begin a write session while another client has one open.</p>
<p>When a session is converted to write mode, all controls that the
service is configured to support are recorded to a save directory in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">geopm</span><span class="o">/</span><span class="n">SAVE_FILES</span>
</pre></div>
</div>
<p>When a write mode session ends, all of these saved controls are
restored to the value they had when the session was converted,
regardless of whether or not they were adjusted during the session
through the service.</p>
<p>In addition to saving the state of controls, the GEOPM Service will
also lock access to controls for any other client until the
controlling session ends.  When the controlling session ends the saved
state is used to restore the values for all controls supported by the
GEOPM Service to the values they had prior to enabling the client to
modify a control.  The controlling session may end by an explicit
D-Bus call by the client, or when the process that initiated the
client session ends.  The GEOPM Service will poll procfs for the
process ID.</p>
</section>
<section id="batch-server">
<h2>Batch Server<a class="headerlink" href="#batch-server" title="Link to this heading">ÔÉÅ</a></h2>
<p>The GEOPM Service provides the implementation for the ServiceIOGroup
which accesses this implementation through the DBus interface.  When a
user program calls <code class="docutils literal notranslate"><span class="pre">read_signal()</span></code> or <code class="docutils literal notranslate"><span class="pre">write_control()</span></code> on a
PlatformIO object provided by libgeopmd and the only
IOGroup that provides the signal or control requested is the
ServiceIOGroup, then each request goes through the slow DBus
interface.  When a client process uses the ServiceIOGroup for batch
operations a separate batch server process is created through the DBus
interface.  The implementations for <code class="docutils literal notranslate"><span class="pre">push_signal()</span></code> and
<code class="docutils literal notranslate"><span class="pre">push_control()</span></code> are used to configure the stack of signals and
controls that will be enabled by the batch server.  This batch server
interacts more directly with the client process to provide low latency
support for the <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> and <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> interfaces of the
ServiceIOGroup.</p>
<p>The batch server is configured to allow access to exactly the signals
and controls that were pushed onto the stack for the ServiceIOGroup
prior to the first <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> or <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> call.
Through the DBus implementation, the GEOPM Service verifies that the
client user has appropriate permissions for the requested signals and
controls.  When the first call to <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> or
<code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> is made to user‚Äôs PlatformIO object, the geopmd
process forks the batch server process and no more updates can be made
to the configured requests.  The batch server uses inter-process
shared memory and FIFO special files to enable fast access to the
configured stack of GEOPM signals and controls.</p>
<p>To implement the <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> method, the ServiceIOGroup writes a
character to a FIFO to notify the batch server that it would like the
configured GEOPM signals to be updated in shared memory.  The client
process then waits on a FIFO for a message from the server that the
request is ready.  The batch server proceeds to read all GEOPM signals
that are supported by the client‚Äôs ServiceIOGroup using the batch
server‚Äôs instance of the PlatformIO object.  GEOPM signals are copied
into the shared memory buffer and when the buffer is ready, a
character is written into the FIFO that the client process is waiting
on.</p>
<p>To implement the <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> method, the client process‚Äôs
ServiceIOGroup prepares the shared memory buffer with all control
settings that the batch server is supporting.  The client then writes
a character into a FIFO to notify the batch server that it would like
the configured GEOPM controls to be written.  The client process then
waits on a FIFO for a message from the server that the controls have
been written.  The batch server proceeds to read the clients settings
from the shared memory buffer and writes the values through the server
process‚Äôs PlatformIO instance.  When the write has completed, a
character is written into the FIFO that the client process is waiting
on.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="service.html" class="btn btn-neutral float-left" title="User Guide for GEOPM Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 - 2024 Intel Corporation. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>